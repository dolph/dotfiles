#!/bin/bash
set -e

sudo dnf upgrade -y --refresh
sudo dnf clean packages

# Upgrade vim plugins
$EDITOR +PluginInstall! +PluginClean! +qall
$EDITOR +GoInstallBinaries +qall

if hash ibmcloud 2>/dev/null; then
    ibmcloud update
    ibmcloud plugin update --all
fi

# On new Fedora installs, sometimes needs-restarting erroneously says the
# system needs to be rebooted, even after rebooting. This has fixed the issue
# twice, on two different systems, on different releases of Fedora (33 and 35).
# sudo dnf remove -y $(sudo dnf repoquery --installonly --latest-limit=-2 -q)
sudo dnf needs-restarting -r
