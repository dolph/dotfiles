---
- name: install dnf-automatic
  dnf:
    name:
    - dnf-automatic
  register: install_dnf_automatic
  until: install_dnf_automatic.rc == 0
  retries: 20
  delay: 0

- name: configure dnf-automatic
  template:
    src: etc/dnf/automatic.conf
    dest: /etc/dnf/automatic.conf
    mode: 0644
    owner: root
    group: root

- name: ensure dnf-automatic is running
  service:
    name: dnf-automatic
    state: restarted
    enabled: true
  failed_when: false # this will fail to start if ibm repos are installed and not on the IBM network
