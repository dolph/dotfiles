#!/bin/bash
set -e

sudo dnf upgrade -y --refresh --best --allowerasing
sudo dnf clean packages

flatpak update -y

# Upgrade vim plugins
$EDITOR +GoInstallBinaries +qall

if hash ibmcloud 2>/dev/null; then
    ibmcloud update
    ibmcloud plugin update --all --force
fi

ONE_WEEK_IN_SECONDS=604800
if [ $(echo "$(cat /proc/uptime | cut -d' ' -f1)/1" | bc) -ge $ONE_WEEK_IN_SECONDS ]; then
    sudo dnf needs-restarting -r
fi
